<!-- toc -->

## 开启编译缓存

``` shell
php dof compile
```

DOF 部署到生产环境时，基本都要先执行下编译命令，这样可以避免每次请求都编译领域文件和注解，可以减少大量重复计算和文件载入。

## 使用存储缓存

涉及到的环境变量 KEY 为：

``` php
// 启用 ORM 缓存
'ENABLE_ORM_CACHE' => true,

// 设置 ORM 存储的缓存驱动
'ORM_STORAGE_CACHE' => 'memcached',

// 设置领域内默认的缓存驱动
'CACHE_DRIVER' => 'memcached',
```

## 关闭日志文件单一写入

涉及到的环境变量 KEY 为：

``` php 
// 日志文件的记录是否记录到单个文件
'FILE_LOGGING_SINGLE' => false,
```

在繁忙的线上环境，如果使用了文件日志的方式，可能会遇到的问题之一就是多个 php 进程会并发地往同一个文件写日志。

将上面的环境变量配置为 `false`，则日志文件的写入会按 PHP 进程号分开，从而缓解这个问题。

> 此选项在开发环境建议设置为 `true`，以方便调试。

## 膨胀的日志文件

如果是采用文件来记录日志，那么一个隐藏的定时炸弹就是日益膨胀的日志文件，如果不加处理，那么应用服务器的磁盘早晚都会被写满。

DOF 文件日志默认提供归档的功能，将单个日志文件大小超过配置限制（默认 4M）会存放到 `var/log-{PHP_USER}/archive/` 目录下，并按年月日及其多种分类归档。推荐将这个归档目录映射到一个足够大的硬盘，然后外部设置一个定时删除的脚本。这样可以避免对应用服务器的威胁。
